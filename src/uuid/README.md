# jig-uuid(1)

## NAME

**jig-uuid** - generate RFC 9562 compliant UUIDs (Universally Unique Identifiers)

## SYNOPSIS

```
jig-uuid [OPTIONS]
```

## DESCRIPTION

**jig-uuid** generates RFC 9562 (formerly RFC 4122) compliant UUIDs. Currently supports UUID version 7, which uses Unix Epoch timestamps for time-ordering and cryptographically secure random data for uniqueness.

UUIDv7 features:
- Time-ordered based on Unix millisecond timestamp
- Cryptographically secure random data using /dev/urandom
- 36-character hyphenated format output
- Lexicographically sortable by creation time
- Suitable for use as database primary keys, distributed system identifiers, and unique file identifiers

Each UUID is 128 bits represented as 32 hexadecimal digits displayed in five groups separated by hyphens: `xxxxxxxx-xxxx-7xxx-Nxxx-xxxxxxxxxxxx`

This is a helper module designed for use in other jig components. The `uuid()` C function can be imported via `uuid/uuid.h` in other modules.

## OPTIONS

- **-h, --help** - Display help information and exit
- **-v VERSION** - UUID version to generate (default: 7, only 7 currently supported)
- **-n COUNT** - Generate N UUIDs (default: 1)

## OUTPUT FORMAT

Standard UUID format (36 characters):
```
xxxxxxxx-xxxx-Vxxx-Nxxx-xxxxxxxxxxxx
```

Where:
- **x** - Hexadecimal digits (0-9, a-f)
- **V** - Version digit (7 for version 7)
- **N** - Variant bits (8, 9, a, or b indicating RFC 9562 variant)

Each UUID is output on a separate line to stdout.

## EXIT STATUS

- **0** - Success (UUIDs generated and output)
- **1** - Error (unsupported version, /dev/urandom unavailable, memory allocation failure, or invalid arguments)

## EXAMPLES

Generate a single UUID:
```bash
$ jig-uuid
019b8f0c-1237-7db7-8fba-8d39b35b6ef0
```

Generate multiple UUIDs:
```bash
$ jig-uuid -n 5
019b8f0c-130c-7c92-9ed6-cd4ce57b7f83
019b8f0c-130c-7ad0-b8b7-88a22e1c4eb6
019b8f0c-130c-77ac-973f-4da846a6b270
019b8f0c-130c-7098-a7ff-b76371a38840
019b8f0c-130c-7471-839d-1d483a304461
```

Explicitly specify version 7:
```bash
$ jig-uuid -v 7
019b8f0c-147a-708e-9af0-eca61e79f243
```

Save UUIDs to a file:
```bash
$ jig-uuid -n 100 > ids.txt
```

Use in shell scripts:
```bash
#!/bin/bash
# Create uniquely named backup file
backup_id=$(jig-uuid)
cp config.json "config-backup-${backup_id}.json"
```

Generate IDs for batch processing:
```bash
# Create 10 note files with unique IDs
for id in $(jig-uuid -n 10); do
    echo "---" > "note-${id}.md"
    echo "id: ${id}" >> "note-${id}.md"
    echo "title: New Note" >> "note-${id}.md"
    echo "---" >> "note-${id}.md"
done
```

## BEHAVIOR

**UUIDv7 Structure**: Per RFC 9562 ยง 5.7, each UUID contains:
- 48-bit Unix timestamp in milliseconds (bits 0-47)
- 4-bit version field set to 7 (bits 48-51)
- 12-bit random data for uniqueness (bits 52-63)
- 2-bit variant field set to 0b10 (bits 64-65)
- 62-bit random data for uniqueness (bits 66-127)

**Timestamp Source**: Uses `gettimeofday()` to obtain current Unix time with microsecond precision, then converts to milliseconds as required by the UUIDv7 specification.

**Random Number Generation**: Uses `/dev/urandom` as a cryptographically secure pseudorandom number generator (CSPRNG) per RFC 9562 ยง 6.9. This ensures UUIDs are both unguessable and have a low collision probability.

**Time Ordering**: UUIDs generated by jig-uuid are lexicographically sortable by creation time (within millisecond precision). UUIDs created in the same millisecond will have random ordering among themselves.

**Collision Resistance**: The combination of timestamp precision and 74 bits of random data provides extremely low collision probability even when generating millions of UUIDs.

**Error Handling**: If `/dev/urandom` is unavailable or cannot be read, the command will fail with an error message rather than falling back to weaker random number generation.

## LIMITATIONS

**Supported Versions**: Currently only UUID version 7 is implemented. Attempting to generate other versions (e.g., `-v 4`) will result in an error.

**Platform Requirements**: Requires Unix-like system with `/dev/urandom` support. Uses standard POSIX APIs (`gettimeofday`, `fopen`, `fread`).

**Timestamp Precision**: Limited to millisecond precision. UUIDs generated within the same millisecond are not guaranteed to be monotonic unless additional counter logic is implemented (future enhancement).

**No Validation**: The tool generates UUIDs but does not validate or parse existing UUID strings.

## INVOCATION MODES

**jig-uuid** is invoked as a standalone executable only:

```bash
jig-uuid [OPTIONS]
```

**Note**: Unlike other jig modules, uuid is **not** integrated as a subcommand of the main `jig` executable (i.e., `jig uuid` is not available). It is designed as a helper module for use within other jig components via the C API.

## C API USAGE

The uuid module can be used in other C programs:

```c
#include "uuid/uuid.h"

char *id = uuid(7);
if (id != NULL) {
    printf("Generated UUID: %s\n", id);
    free(id);  // Caller must free the returned string
}
```

The `uuid()` function:
- Takes an integer version parameter (only 7 is currently supported)
- Returns a dynamically allocated 36-character string
- Returns NULL on error (with error message to stderr)
- Caller is responsible for freeing the returned string

## RFC COMPLIANCE

This implementation follows RFC 9562 (Universally Unique IDentifiers) specifications:
- Section 4.1: Variant Field (set to 0b10 for RFC-compliant UUIDs)
- Section 4.2: Version Field (set to 0b0111 for version 7)
- Section 5.7: UUID Version 7 (Unix Epoch time-based)
- Section 6.1: Timestamp Considerations
- Section 6.9: Unguessability (CSPRNG requirement)

See `spec.md` in the uuid module directory for relevant RFC excerpts.

## SEE ALSO

- RFC 9562: Universally Unique IDentifiers (UUIDs)
- RFC 4122: A Universally Unique IDentifier (UUID) URN Namespace (obsoleted by RFC 9562)
- `/dev/urandom` - Kernel random number generator

## BUILD

Build the standalone executable:

```bash
cd src/uuid
make
```

The binary will be created at `bin/jig-uuid`.

Clean build artifacts:

```bash
cd src/uuid
make clean
```

Rebuild from scratch:

```bash
cd src/uuid
make rebuild
```
